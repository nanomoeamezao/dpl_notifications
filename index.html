<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Chat Example</title>
        <script type="text/javascript">
            let conn
            var id
            window.onload = () => {
                var log = document.getElementById('log')
                id = document.getElementById('uid')
            }
            const connectWS = () => {
                if (!conn || conn.readyState == 2 || conn.readyState == 3) {
                    conn = new WebSocket('ws://' + document.location.host + '/ws')
                    document.cookie= "UID=" + id.value
                }
                conn.onclose = function (evt) {
                    var item = document.createElement('div')
                    item.innerHTML = '<b>Connection closed.</b>'
                    appendLog(item)
                }
                conn.onmessage = function (evt) {
                    var messages = evt.data.split('\n')
                    for (var i = 0; i < messages.length; i++) {
                        var item = document.createElement('div')
                        item.innerText = messages[i]
                        appendLog(item)
                    }
                }
            }
            function appendLog(item) {
                log.appendChild(item)
            }
            const disconnectWS = () => {
                conn.close()
            }
        </script>
        <style type="text/css">
            html {
                overflow: hidden;
            }

            body {
                overflow: hidden;
                padding: 0;
                margin: 0;
                width: 100%;
                height: 100%;
                background: gray;
            }

            #log {
                background: white;
                margin: 0;
                padding: 0.5em 0.5em 0.5em 0.5em;
                height: 500px;
                top: 0.5em;
                left: 0.5em;
                right: 0.5em;
                bottom: 3em;
                overflow: auto;
            }

            #form {
                padding: 0 0.5em 0 0.5em;
                margin: 0;
                position: absolute;
                bottom: 1em;
                left: 0px;
                width: 100%;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <div id="log"></div>
        <button id="connect" onclick="connectWS()">connect</button>
        <textarea id="uid" >111</textarea>
        <button id="disconnect" onclick="disconnectWS()">disconnect</button>
    </body>
</html>
